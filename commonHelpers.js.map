{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport axios from 'axios';\nconst refs = {\n  searchForm: document.querySelector('.search-form'),\n  photoList: document.querySelector('.photo-list'),\n  loader: document.querySelector('.loader'),\n  loaderBottom: document.querySelector('.loader-before-button'),\n  loadMoreBtn: document.querySelector('.fetch-more-button'),\n};\nconst hiddenClass = 'is-hidden';\nconst refreshPage = new SimpleLightbox('.photo-list a', {\n  captions: true,\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nlet page = 1;\nlet query = '';\nlet maxPage = 0;\n\nconst BASE_URL = 'https://pixabay.com/api';\nconst API_KEY = '41870399-9b44301246ceb98c07efd626a';\n\nrefs.searchForm.addEventListener('submit', handleSearch); // обробник подій на форму подія submit\n// пишемо функцію для того щоб робити запит\n// функція,яка описує обробник події  handleSearch\nasync function handleSearch(event) {\n  event.preventDefault(); // скидуємо стандартну поведінку браузера\n\n  refs.photoList.innerHTML = ''; // очищаємо вміст галереї (перед здійсненням нового пошуку вміст\n  // галереї очищаємо щоб уникнути переплутання результатів)\n  refs.loader.classList.remove(hiddenClass);\n  page = 1; // коли робимо запит на нову тему сторінки очищаються\n  const form = event.currentTarget;\n  query = form.elements.query.value; // дістаємо значення з форми\n\n  // перевірка на пустий рядок запиту\n\n  if (!query) {\n    // refs.loadMoreBtn.disabled = false;\n    refs.loadMoreBtn.classList.add(hiddenClass);\n    refs.loader.classList.add(hiddenClass);\n    iziToast.show({\n      message: 'Please enter your request',\n      position: 'topRight',\n      color: 'yellow',\n    });\n    return;\n  }\n  try {\n    const { hits, totalHits } = await searchPhoto(query); //посилаємо перший запит на сервер\n    console.log(totalHits);\n    // рахуємо і записуємо в обʼєкт максимальну кількість сторінок в нашому запиті,  для цього ділимо кількість\n    //  результатів на кількість обʼєктів, які ми отримуємо за один запит + округляємо в більшу сторону\n    maxPage = Math.ceil(totalHits / 40);\n    console.log(maxPage);\n    createMarkuPhoto(hits, refs.photoList); // додали нові елементи до списку зображень\n\n    // перевірка на те, чи показувати кнопку при першому запиті (при сабміті форми),\n    // якщо кількість обʼєктів відповіді більша за нуль та кількість обʼєктів відповіді не рівна\n    // загальної кількості результатів, то показуємо кнопку.Інакше - не показуємо\n    if (hits.length > 0 && hits.length !== totalHits) {\n      refs.loadMoreBtn.classList.remove(hiddenClass);\n      refs.loadMoreBtn.addEventListener('click', handleButton);\n      // якщо нічого не знайдено , тобто об'єкт відповіді не знайдений\n    } else if (!hits.length) {\n      refs.loadMoreBtn.classList.add(hiddenClass);\n      iziToast.error({\n        title: '❌',\n        messageColor: 'white',\n        message:\n          'Sorry, we dont have any pictures for your request.Please enter correct request!',\n        position: 'bottomCenter',\n        color: 'red',\n      });\n    } else {\n      refs.loadMoreBtn.classList.add(hiddenClass);\n    }\n  } catch (error) {\n    console.log(error);\n  } finally {\n    refs.loader.classList.add(hiddenClass);\n    form.reset();\n  }\n}\nasync function searchPhoto(value, page = 1) {\n  try {\n    const resp = await axios.get(\n      `${BASE_URL}/?key=${API_KEY}&q=${value}&image_type=photo&orientation=horizontal&safesearch=true&per_page=40&page=${page}`\n    );\n    // витягуємо масив об'єктів\n    console.log(resp.data);\n    return resp.data;\n  } catch (error) {\n    iziToast.error({\n      title: 'Error',\n      titleSize: '30',\n      messageSize: '25',\n      message: 'Sorry! Try later! Server not working',\n    });\n    console.error(error.message);\n  }\n}\n// обробник подій на кнопку LOAD MORE\n\nasync function handleButton() {\n  // перед тим як робимо запит на сервер робимо спочатку відключення кнопки\n  refs.loadMoreBtn.disabled = true;\n\n  page += 1;\n\n  //перед початком запиту loader показуємо ( для цього прибираємо схований клас який на loader \"is-hidden по замовчуванню\")\n  refs.loaderBottom.classList.remove(hiddenClass);\n\n  try {\n    const { hits } = await searchPhoto(query, page);\n    createMarkuPhoto(hits, refs.photoList);\n  } catch (error) {\n    console.log(error);\n  } finally {\n    //розблоковуємо кнопку в кінці коли запит завершиться , loader ховаємо\n    refs.loaderBottom.classList.add(hiddenClass);\n    refs.loadMoreBtn.disabled = false;\n\n    //і обовʼязково після натискання на кнопку та закінчення запиту робимо перевірку що :\n    //якщо ми зараз знаходимось на останній сторінці - то ховаємо кнопку і видаляємо обробник подій!\n    // ПЕРЕВІРКА якщо поточна сторінка = максимальній , то ховаємо кнопку\n    if (page === maxPage) {\n      refs.loadMoreBtn.classList.add(hiddenClass);\n      refs.loadMoreBtn.removeEventListener('click', handleButton);\n      iziToast.show({\n        title: '❌',\n        messageColor: 'white',\n        message: \"We're sorry, but you've reached the end of search results.\",\n        position: 'bottomCenter',\n        color: 'red',\n      });\n    }\n  }\n}\n\nfunction createMarkuPhoto(data) {\n  const markup = data\n    .map(\n      hits => `<li class=\"gallery-item\">\n<a class=\"gallery-link\" href=\"${hits.largeImageURL}\">\n<img class=\"gallery-image\" ;\n    src=\"${hits.webformatURL}\"\n    data-source=\"${hits.largeImageURL}\"\n   alt=\"${hits.tags}\" />\n   </a>\n    <p>Likes: ${hits.likes}</p>\n   <p>Views: ${hits.views}</p>\n   <p>Comment: ${hits.comments}</p>\n   <p>Downloads: ${hits.downloads}</p>\n</li>`\n    )\n    .join('');\n  // додаємо нові елементи до галереї\n  refs.photoList.insertAdjacentHTML('beforeend', markup);\n  refreshPage.refresh();\n}\n"],"names":["refs","hiddenClass","refreshPage","SimpleLightbox","page","query","maxPage","BASE_URL","API_KEY","handleSearch","event","form","iziToast","hits","totalHits","searchPhoto","createMarkuPhoto","handleButton","error","value","resp","axios","data","markup"],"mappings":"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"}